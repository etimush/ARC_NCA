<!--
  Copyright 2018 The Distill Template Authors

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!DOCTYPE html>
###<!--[if IE lte 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" defer></script><![endif]-->
<head>
  <script src="./template.v2.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel = "stylesheet" href="style.css">
  <meta charset="utf8">
</head>

<body>

  <d-front-matter>
    <script id='distill-front-matter' type="text/json">{
    "title": "Diffusion Lenia",
    "description": "Although \" extremely useful for visualizing high-dimensional data, t-SNE plots can sometimes be mysterious or misleading.",
    "published": "Jan 15, 2025",

    "authors": [
      {
        "author":"Vassilis Papadopoulos",
        "authorURL":"https://scholar.google.com/citations?user=4o52I2oAAAAJ&hl=en",
        "affiliations": [{"name": "École polytechnique fédérale de Lausanne (EPFL)", "url": "https://www.epfl.ch/en/"}]
      },
      {
        "author":"Etienne Guichard",
        "authorURL":"",
        "affiliations": [{"name": "Østfold University College", "url": "https://www.hiof.no/english/"}]
      }
    ],
    "katex": {
      "delimiters": [
        {"left": "$$", "right": "$$", "display": false}
      ]
    }
  }</script>
  </d-front-matter>
  <d-title>
    <figure style="grid-column: page; margin: 1rem 0;"><video loop autoplay playsinline muted width="150px"; src="figures/sample_video.mp4" style="width:30%; border: 0px solid rgba(0, 0, 0, 0.2);"/></figure>
    <p>Sample Text: Diffusion Lenia.</p>
  </d-title>
  <d-byline></d-byline>

  <d-article margib-bottom: 0>
    <p style="color:#696969;font-size:13px;">Paper Repository: <a href="https://github.com/frotaur/DiffLenia" target="_blank">GitHub</a> <br>Preprint: <a href="https://arxiv.org/" target="_blank">PreprintName</a>
</a></p>

  </d-article>

<d-article class="center">


    <a class="marker" href="#section-1" id="section-1"></a>
    <h2>Introduction</h2>

<d-contents class="sticky">
  <nav class="l-text toc figcaption">
    <h3>Contents</h3>
    <div><a href="#section-1">Introduction</a></div>
    <div><a href="#section-2">Model</a></div>
      <ul>
    <div><a href="#section-2.1">Diffusion Lenia Evolution Equation</a></div>
    <div><a href="#section-2.2">The ‘inverse temperature’\beta</a></div>
      </ul>
    <div><a href="#section-6">Related Work</a></div>
    <div><a href="#section-7">Discussion</a></div>
    <div><a href="#section-8">Conclusion</a></div>
  </nav>
</d-contents>

    <p>Sample ref: <d-cite key="placeholder"></d-cite></p>
    <h4>Sample math:</h4>
    <d-math block>
      c = \pm \sqrt{ \sum_{i=0}^{n}{a^{222} + b^2}}
    </d-math>
    <p>Sample footnote <d-footnote>Footnote</d-footnote> </p>
    <figure style="text-align: center; margin: 2rem 0;" id="figure-augment"><img playsinline src="figures/Sample_img.jpg";
          style="width:50%; border: 0px solid rgba(0, 0, 0, 0.2);" /></figure><figcaption>Sample figure and caption.</figcaption>
    <p>Sample cross-reference to figure  (<a href="#figure-augment" class="figure-link" data-target="figure-augment"></a>)</p>
    <a class="marker" href="#section-2" id="section-2"></a>
    <h2>Model</h2>
    <p>Diffusion Lenia is a state-continuous cellular automaton. It incorporates the growth-computation of Lenia, while
        implementing the update rule in a mass-conserving manner. While similar to other mass-conserving approaches such
        as Flow-Lenia, its update rule differs significantly.</p>

    <a class="marker" href="#section-2.1" id="section-2.1"></a>
    <h2>Diffusion Lenia Evolution Equation</h2>
    <p>Denote the ‘mass density field’ as <d-math>\rho^t_{ij}\in R^c </d-math>, where <d-math>c</d-math> is the number of channels, which we will set
        to 1 for simplicity, but everything follow. <d-math>i,j \in \mathbb{Z}^2</d-math> denote the discretization of the 2D space,
        and <d-math>t</d-math> denotes the time-step.</p>

    <p>Following Lenia, we have some kernel <d-math>K_{ij}</d-math>, and a growth function <d-math>G(x) \in \mathbb{R}</d-math>. By convolving the
        mass density field <d-math>\rho^t</d-math>, then applying the growth function pointwise for the result, we obtain the
        pre-affinity field, denoted <d-math>A_{ij}</d-math></p>

    <d-math style="text-align: center; margin: 2rem 0;" >
    A_{ij} = G(K*\rho^t)_{ij}</d-math>

    <p>This quantity is computed the same way as in Lenia. However, we do not use it directly as a ‘growth’ of the density
        field, rather these values will be interpreted as an ‘affinity’ or ‘attraction’ for mass. In other words, locations
        with greater values of <d-math>A_{ij}</d-math> will tend to attract more mass. More precisely, each pixel <d-math>(i,j)</d-math> will compete
        for mass inside its neighborhood <d-math>\mathcal{N}(i,j)</d-math> (we use the Moore neighborhood, but the evolution equation is
        applicable for arbitrary neighborhoods, as long as they satisfy the reflexivity condition, see below).</p>

    <p>Specifically, the evolution equation is : </p>
    <d-math style="text-align: center; margin: 2rem 0;">Z_{ij} = \sum_{k,l\in\mathcal{N}(i,j)}e^{\beta A_{ij}}
        </d-math>

    <d-math style="text-align: center; margin: 2rem 0;">\rho^{t+1}_{ij}=\sum_{i',j'\in \mathcal{N}(i,j)} \frac{e^{\beta A_{ij}}}{Z_{i'j'}}\rho^t_{i'j'}</d-math>

    <p>We introduce an extra hyperparameter <d-math>\beta</d-math> which can be thought as a vague analog of an inverse temperature; 
        <d-math>Z_{ij}</d-math> is a normalization parameter, it computes the total affinity in the full neighborhood <d-math>\mathcal{N}(i,j)</d-math>. 
        Note that we run our ‘pre-affinities’ <d-math>A_{ij}</d-math> into an exponential for positivity, which guarantees that <d-math>Z_{ij}>0</d-math>. 
        Thus, our affinities are actually the <d-math>e^{\beta A_{ij}}</d-math>.</p>

    <p>It can be easily shown that <d-math>(*)</d-math> conserves the total mass. Indeed, summing over all pixels : </p>

    <d-math style="text-align: center; margin: 2rem 0;">
M^{t+1} = \sum_{i,j} \rho_{ij}^{t+1} = \sum_{i,j}\sum_{i',j'\in\mathcal{N}(i,j)}\frac{e^{\beta A_{ij}}}{Z_{i'j'}}\rho^t_{i'j'}</d-math>

    <d-math style="text-align: center; margin: 0rem 0;">= \sum_{i',j'}\frac{\rho^t_{i',j'}}{Z_{i'j'}}\sum_{i,j\in\mathcal{N}(i',j')}e^{\beta A_{ij}} = \sum_{i',j'}\frac{\rho^t_{i',j'}}{Z_{i'j'}}Z_{i'j'} = \sum_{i',j'}\rho^t_{i',j'} = M^t</d-math>
    <p></p>

    <p>To invert the sums, we used the fact that <d-math>\sum_{i,j}\sum_{k,l\in \mathcal{N}(i,j)} = \sum_{i,j}\sum_{k,l} \mathbb{1}_{k,l\in \mathcal{N}(i,j)} =\sum_{i,j}\sum_{k,l} \mathbb{1}_{i,j\in \mathcal{N}(k,l)}= \sum_{k,l}\sum_{i,j\in \mathcal{N}(k,l)}</d-math> which simply comes from reflexivity of the neighborhood relation :  <d-math>k,l \in \mathcal{N}(i,j)\Leftrightarrow i,j \in \mathcal{N}(k,l)</d-math> . For ‘reasonable’ neighborhoods, this is always true, as ‘being neighbor of’ should in general satisfy reflexivity.</p>

    <p>Let us understand a bit more intuitively why this evolution rule conserves mass. As we have said, the amount of
        mass each pixel receives is dependent on its affinity. But how exactly? Well, each pixel <d-math>(i,j)</d-math>
        decides how to redistribute its mass to its neighborhood by partitioning it according to its own local distribution,
        given by <d-math>\frac{e^{\beta A_{i'j'}}}{Z_{ij}}</d-math>. Now, each pixel <d-math>(i',j') </d-math> in its
        neighborhood (i.e. including itself) will receive a portion  <d-math>\frac{e^{\beta A_{i'j'}}}{Z_{ij}}</d-math>
        of its mass, i.e. <d-math>\frac{e^{\beta A_{i'j'}}}{Z_{ij}}\rho^t_{ij}</d-math>. That’s it! So, each pixel <d-math>i,j</d-math>
        receives contributions from all the pixels <d-math>i'j'</d-math> in their neighborhood. </p>

    <p>According to the above discussion the neighbor pixel <d-math>i'j'</d-math> will give <d-math>\frac{e^{\beta A_{ij}}}
        {Z_{i'j'}}\rho^t_{i'j'}</d-math>, so all we need to compute the new density value for <d-math>\rho^{t+1}_{ij}</d-math>
        is to sum all these contributions, which gives us exactly equation <d-math>(*)</d-math>. As we can see, the evolution rule involves simply a
        reshuffling of the total mass, and as such it is obviously conservative.</p>

    <p>This point of view is reminiscent of the evolution rule for Flow-Lenia. In Flow-Lenia, a flow field is computed using
        the gradient of the pre-affinity. Then, matter is moved along this flow field using ‘reintegration tracking’. The update rule is  :</p>

    <d-math style="text-align: center; margin: 2rem 0;">
            \rho^{t+1}(x) = \sum_{x'} I(x',x)\rho^t(x') </d-math>


    <p>Where <d-math>I(x',x)</d-math> denotes the portion of mass going from <d-math>x'</d-math> to <d-math>x</d-math>.
        In Flow Lenia, the effective ‘neighborhood’ is technically the full domain, as mass could in principle flow in from arbitrary distances.
        It suffices then to require the condition <d-math>\sum_{x} I(x',x)=1</d-math>, and we have conservation of mass.</p>

    <p>As such, we can describe a full ‘family’ of mass-conserving CA’s, of which both Flow-Lenia and Diffusion-Lenia are examples : </p>

    <d-math style="text-align: center; margin: 2rem 0;">
        \rho^{t+1}(x) = \sum_{x'} I(x',x)\rho^t(x'), \,\,\, \sum_x I(x',x) = 1</d-math>

    <p>In Diffusion Lenia, we can pictorially write <d-math>I(x',x) = \frac{e^{\beta A(x)}}{Z(x')} \mathbb{1}_{x'\in \mathcal{N}(x)}</d-math>.</p>

    <a class="marker" href="#section-2.2" id="section-2.2"></a>
    <h2>The ‘inverse temperature’ <d-math>\beta</d-math> </h2>

    <p></p>Here an image of the temperature as a function of space would be nice to visualize</p>
    <p>Let us understand the role of <d-math>\beta</d-math>, first by analyzing its limits.</p>
    <p>In the limit <d-math>\beta\rightarrow 0</d-math>, the affinity values <d-math>A(x)</d-math> become meaningless; each cell effectively has the 
        same affinity value. Therefore, each cell redistributes its matter equally to all neighbors. The evolution equation becomes : </p>

    <d-math style="text-align: center; margin: 2rem 0;">
            \rho^{t+1}_{ij}=\frac{1}{|\mathcal{N}|}\sum_{i',j'\in \mathcal{N}(i,j)}\rho^t_{i'j'}</d-math>

    <p>Each cell becomes the average of the cells in its neighborhood. In the case where <d-math>\mathcal{N}</d-math> is the Moore 
        neighborhood, <d-math>|\mathcal{N}|=9</d-math>, and we can re-write the equation as :</p>

    <d-math style="text-align: center; margin: 2rem 0;">
\rho^{t+1}_{ij}-\rho^t_{ij}=\frac{1}{9}(K*\rho^t)_{ij}</d-math>

    <d-math style="text-align: center; margin: 2rem 0;">K = \begin{pmatrix} 1 & 1 & 1 \\ 1 & -8 & 1 \\ 1 & 1 & 1 \end{pmatrix}</d-math>
    
    <p>Where <d-math>K*\rho^t</d-math> denotes the convolution. In this form, we recognize the discretization of the diffusion equation</p>




    <a class="marker" href="#section-6" id="section-6"></a>
    <h2>Related Work</h2>

    <a class="marker" href="#section-7" id="section-7"></a>
    <h2>Discussion</h2>
    <p>A discussion of the results, their significance  and meaning.</p>

    <a class="marker" href="#section-8" id="section-8"></a>
    <h2>Conclusion </h2>
    <p>Conclusion to wrap up the paper summarising what was done and how the results are significant</p>



    <!-- if something breaks later on, add back script section form ref.html -->


  </d-article>
  <d-appendix>

    <d-bibliography src="bibliography.bib"></d-bibliography>
  </d-appendix>

<script src="./figs.js"></script>
</body>